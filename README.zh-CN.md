# 雨桶

> 这个项目是关于一个智能水箱。它测量水位并将数据发送到服务器。服务器可用于控制水泵。该泵可以通过网络界面或电报机器人进行控制。它使用HC-SR04超声波传感器来测量水位。数据通过 LoRaWAN 网关发送到 TTN。

?> 原始文档是这样写的[英语](README.md)。翻译是用谷歌翻译完成的。如果您发现任何错误，请尝试忽略它们。谢谢你！

* * *

## 表中的内容

1.  **快速开始**
    1.  介绍
    2.  硬件
    3.  闪存软件
2.  **硬件**
    1.  传感器
    2.  电源
    3.  住房
    4.  微控制器
    5.  网关（可选）
3.  **组装**
    1.  传感器到控制器
    2.  控制器电源
    3.  故障排除
4.  **设置**
    1.  TTN
        1.  创建账户
        2.  创建应用程序
        3.  配置解码器
        4.  复制凭证
    2.  设备
        1.  下载驱动程序
        2.  闪烁
        3.  配置
5.  **调试**
    1.  串行监视器
    2.  TTN 控制台
    3.  MQTT客户端
    4.  陷阱
6.  **数据工程**
    1.  红色节点
    2.  格拉法纳
    3.  亚历克斯·技能
    4.  Azure 连接

* * *

## 快速开始

### 快速入门 - 简介

本快速入门专为想要立即开始使用 Arudino 框架并深入了解物联网的人们而设计。如果你想了解它是如何工作的，你可以阅读[文档](#hardware).

### 快速入门 - 硬件概述

您需要以下部件：

![Overview](_media/hardware/hardware-overview.png ":size=200")

-   带 LoRa 芯片的微控制器
-   传感器
-   电源
-   住房

?> 如果您想了解更多有关部件的信息，您可以阅读[硬件文档](#Hardware).

### 快速入门 - Flash 软件

1.  将您的开发板连接到计算机，然后
2.  单击以下按钮：

<esp-web-install-button manifest="/static/firmware_build/manifest.json"></esp-web-install-button>

?> 如果你想了解更多关于刷机过程，可以阅读[设置文档](#Setup).

## 硬件

1.  [传感器](#Sensors)
2.  [电源](#Power-supply)
3.  [住房](#Housing)
4.  [微控制器](#Microcontroller)
5.  [网关](#Gateway)

### 传感器

要测量水位，您需要一个传感器。找到一个防水且可以在水箱中使用的传感器并不是一件容易的事。支持并推荐以下传感器：

#### 初学者

如果您是初学者，我们建议您使用廉价的传感器来构建您的第一个原型。支持并推荐以下传感器：

| 部分                                                  | 描述                                                                                                                                                                                                                                                                     |
| --------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![HC-S04 sensor](_media/hardware/sensor-hcsr04.svg) | [HC-SR04 超声波传感器](https://amzn.to/3MHNrbJ)该传感器相对便宜且易于使用。它不防水。您必须将其放入防水外壳中。如果您只是想尝试一下，我们推荐该传感器。不建议长期使用。这**HC-SR04**传感器是用于距离测量的超声波传感器。它发出高频声波，并检测声波撞击物体后反弹所需的时间。然后使用该时间来计算传感器和物体之间的距离。它的范围可达 4 米，可与 Arduino、Raspberry Pi 等微控制器连接。HC-SR04 常用于机器人、自动化、安全系统和其他需要准确可靠距离感测的应用。 |
| ![](_media/hardware/sensor-vl6180x.svg)             | [BL6180X](https://amzn.to/3zVEFPM)飞行时间传感器相对便宜且易于使用。 VL6180X激光测距模块是一款利用激光测量传感器与物体之间距离的传感器。它是一种飞行时间 (ToF) 传感器，这意味着它测量激光从物体反射并返回传感器所需的时间。该传感器不防水，但精度更高。您必须将其放入防水外壳中。如果您只是想尝试一下，我们推荐该传感器。不建议长期使用。                                                                          |

#### 先进的

如果您想长期使用该项目，我们建议使用更昂贵的传感器。支持并推荐以下传感器：

| 部分                                                                     | 描述                                                                                                                                                                                                                                                                                                                                                                           |
| ---------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![CQRobot](_media/hardware/sensor-water-CQRobot.svg)                   | [接触式水位传感器](https://amzn.to/41sKAaL)这种传感器利用光学原理来检测液位，称为光电水位传感器。此类传感器的一大优点是其出色的灵敏度，且无需机械部件，因此校准频率较低。传感器探头本身体积小，放置方向灵活，可以检测溶液溢出、干燥度和水平水平等多种情况。此外，该传感器还可以用作提醒和警报系统。该装置内置发光二极管和光电晶体管，带电部分与受控液体完全隔离，确保安全。                                                                                                                                                                          |
| ![Water proof Ultrasonic Sensor](_media/hardware/sensor-JSN-SR04T.svg) | [防水超声波传感器](https://amzn.to/3MNk4F2)JSN-SR04T是一款超声波传感器模块，利用声纳技术来检测物体的距离。这种紧凑且易于使用的模块具有高精度和可靠性，使其成为包括机器人、自动化和安全系统在内的各种应用的理想选择。该传感器的检测范围可达5米，可检测15度角内的物体。它的工作频率为 40 kHz，分辨率为 1 cm。该模块还内置温度补偿功能，即使在不同的温度条件下也能确保稳定、准确的读数。**JSN-SR04T**模块采用防水防尘外壳设计，适合恶劣环境下使用。它易于安装，并通过其简单的三针接口与各种微控制器（例如 Arduino 和 Raspberry Pi）无缝集成。总体而言，JSN-SR04T 超声波传感器模块对于为其项目寻找可靠且准确的距离测量解决方案的任何人来说是一个绝佳的选择。 |

### 电源

要为微控制器供电，您需要电源。 18650电池是最好的选择。它很便宜，你可以用太阳能电池板充电。但您也可以使用移动电源或 USB 电源。

| 部分                                                      | 描述                                                                                                                                                                                                                                                                                              |
| ------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![18650 battery](_media/hardware/hardware-18650.svg)    | 电池有多种类型。最常见的是锂离子、锂聚合物和磷酸铁锂。这**18650电池**是锂离子电池。这是该项目的最佳选择。它很便宜，你可以用太阳能电池板充电。它由锂离子制成，最多可充电 500 次。 18650电池的电压为3.7V，容量约为2200mAh。太阳能电池板电压为5V，功率为2W。太阳能电池板可在 3 小时内为电池充满电。我们的传感器需要 5V 和 100mA。微控制器需要5V和100mA。所以我们需要两节18650电池和一个稳压器来获得5V电压。电池不防水。您必须将其放入防水外壳中。还要注意高温。如果电池太热，电池可能会爆炸。如果您想长时间使用，我们推荐这款电池。 |
| ![Solar panel](_media/hardware/hardware-solarpanel.svg) | **太阳能板：**由于我们在花园里，因此我们可以使用太阳能电池板。它是防水的，可以在雨中使用。它由多晶硅制成，功率为2W。如果您购买太阳能电池板，则必须确保其具有至少 400mA 的 5V 输出。为了给电池充电，我们需要一个充电控制器。幸运的是，微控制器内置了充电控制器。所以我们可以直接使用太阳能电池板。                                                                                                                                       |

### 住房

为了保护传感器和微控制器，您需要一个外壳。外壳必须防水并且具有一定的耐高温和紫外线辐射能力。
使用**聚对苯二甲酸乙二醇酯**对原型有好处。它不防水，可能会被紫外线辐射损坏。使用**聚对苯二甲酸乙二醇酯**供长期使用。它防水、抗紫外线。您还可以使用**ABS**。它防水、抗紫外线。

甚至**特百惠**是一个不错的选择。它防水、抗紫外线。

### 微控制器

微控制器是系统的大脑。它负责测量水位并将数据发送到服务器。支持并推荐以下微控制器：

| 部分                                                                  | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![Seamuing SX1262 LoRa Modul](_media/hardware/hardware-esplora.svg) | 这[Seamuing SX1262 LoRa 模块 868](https://amzn.to/3UFRGq5)是带有 LoRa 模块的微控制器。它价格便宜且易于使用。SX1262 是一款高度集成的低功耗、长距离收发器，设计用于各种无线通信应用。它具有超低功耗模式，非常适合需要长电池寿命的电池供电应用。 SX1262采用LoRa调制技术，能够以最小的功耗实现远距离通信。 SX1262 在视距条件下的有效范围可达 15 公里，在城市环境中可达 2 公里，是长距离无线通信应用的绝佳选择。该收发器的工作频率范围为 860-930 MHz，因此能够满足广泛的地区监管要求。它还具有 -148 dBm 的高灵敏度，即使在嘈杂或信号微弱的环境中也能实现可靠的通信。 SX1262 设计有高度可配置的接口，使其能够轻松集成到各种应用中。它还具有低功耗待机模式，可降低收发器不使用时的功耗。总体而言，SX1262 是一款高度通用且可靠的收发器解决方案，非常适合各种无线通信应用，包括物联网、智能计量和工业自动化。**它不防水。**您必须将其放入防水外壳中。如果您只是想尝试一下，我们推荐这款微控制器。不建议长期使用。 |

### 网关

检查 TTN 地图，看看您附近是否有网关。如果您附近没有网关，您可以购买网关，但需要互联网连接。网关是微控制器和TTN服务器之间的桥梁。支持并推荐以下网关：

| 部分                                                   | 描述                                                                                                                                                                                                                                                  |
| ---------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![TTN gateway](_media/hardware/hardware-gateway.svg) | [TTN室内网关](https://amzn.to/3L1x1JN)该网关旨在与物联网 v3 无缝协作，提供安全设备激活、全球覆盖和轻松设备管理等一系列功能。它还内置对低功耗蓝牙 (BLE) 和 Wi-Fi 的支持，可使用智能手机或计算机轻松配置和管理。总体而言，对于为 LoRaWAN 网络寻找可靠、易于使用的网关的任何人来说，Things Indoor LoRaWAN 室内网关 TTNv3 是一个绝佳的选择。它经济实惠、节能且具有多种功能，使其成为商业和工业物联网应用的理想选择。 |

## 3. 组装

1.  [传感器到控制器](#sensor-to-controller)
2.  [控制器电源](#power-to-controller)
3.  [故障排除](#trouble-shooting)

### 传感器到控制器

此示例说明了如何将 HC-SR04 传感器组装到微控制器上。传感器通过 4 针电缆连接到微控制器。黄色电缆是触发电缆。蓝色电缆是回声电缆。红色电缆是 5V 电缆。黑色电缆是地线。

![Schema for ultra sonic sensor](_media/schema/schema-regenfass-ultrasonic.png)

### 控制器电源

### 故障排除

* * *

#### 洛拉万

-   LoRaWAN网关

#### 微控制器

显然，您需要一块板来运行该软件。但你还需要一个LoRa芯片来将数据发送到TTN。支持以下板：

-   [前往拉阿](Hardware/TTGOLoRa32.md)
-   [Heltec LoRa32](Hardware/HeltecLoRa32.md)

### 示意图

![Schematic](https://raw.githubusercontent.com/Regenfass/Regenfass/master/Hardware/Schematic.png)

### 3D 打印零件

## 软件

### Arduino

-   [Arduino](Software/Arduino/README.md)

### 服务器

-   [服务器](Software/Server/README.md)

### 电报机器人

-   [电报机器人](Software/TelegramBot/README.md)

## 贡献

-   [HTTPS://GitHub.com/TT那Leipzig/热跟法师说-火车-虽然04/](https://github.com/ttnleipzig/regenfass-hc-sr04/)
-

## 执照

[署名-非商业性-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)](https://creativecommons.org/licenses/by-nc-sa/4.0/)

**您可以自由地：**

-   共享 — 以任何媒介或格式复制和重新分发材料
-   改编——重新混合、转换并在材料的基础上进行构建

* * *

_由 ❤️ 制作[文档化](https://docsify.js.org/)_
